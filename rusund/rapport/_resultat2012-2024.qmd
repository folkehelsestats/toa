```{r setup-hist}
#| echo: false
#| warning: false

cleanFile <- file.path("rusund", "cleaning", "history", "history-cleaning.R")
## Datasettet DD blir laget her
source(file.path(here::here(), cleanFile))
```

## Andel av alkoholbruk siste år 

```{r cal-bruk}
#| echo: false
#| warning: false

drkAlle <- proscat("year", "alkosistaar", d = DD, total = FALSE)
drk <- proscat("year", "alkosistaar", z = "kjonn", d = DD, total = FALSE)

## Bare de som svarte Ja
drkAlle[, kjonn := 3] #totalt
drkAlleX <- drkAlle[alkosistaar == 1]
                      
drkX <- drk[alkosistaar == 1]

drkDT <- data.table::rbindlist(list(drkAlleX, drkX), use.names = TRUE)
drkDT[, kjonn := as.integer(kjonn)]

kjonnVal <- c("Menn" = 1, "Kvinner" = 2, "Alle" = 3)
kjonnKB <- data.table(v1 = as.integer(kjonnVal),
                      v2 = names(kjonnVal))

drkDT[, kjonn := as.numeric(kjonn)]
drkDT[kjonnKB, on = c(kjonn = "v1"), kjonn2 := i.v2]
setorder(drkDT, year, kjonn)

drkMax <- drkAlle[alkosistaar == 1, max(percentage, na.rm = TRUE)]
drkMin <- drkAlle[alkosistaar == 1, min(percentage, na.rm = TRUE)]
```

Andelen som rapporterte å ha konsumert alkohol i løpet av de siste 12 månedene
har vært relativt stabil i perioden 2012 til 2024, og har ligget mellom `r round(drkMin, digits = 0)`%
og `r round(drkMax, digits = 0)`%, tilsvarende omtrent 8 av 10 personer.

::: {.panel-tabset}
### Figur
```{r fig-bruk}

make_hist(d = drkDT,
          x = year,
          y = percentage,
          group = kjonn2,
          n = count,
          title = "Alkoholbruk siste 12 måneder 2012-2024",
          subtitle = "Kilde: Rusundersøkelse 2012-2014 ",
          type = "line",
          dot_size = 6,
          flip = FALSE)
```

### Tabell

```{r tab-bruk}

drkDTT <- data.table::rbindlist(list(drkAlle, drk), use.names = TRUE)

alkoVal <- c("Drukket" = 1, "Ikke drukket" = 2)
alkoKB <- data.table(v1 = as.integer(alkoVal),
                     v2 = names(alkoVal))

drkDTT[alkoKB, on = c(alkosistaar = "v1"), alko := i.v2]
drkDTT[, kjonn := as.numeric(kjonn)]
drkDTT[kjonnKB, on = c(kjonn = "v1"), kjonn2 := i.v2]

cols <- c("alkosistaar", "sum", "kjonn")
drkDT[, (cols) := NULL]

colout <- c("alko", "year", "count", "percentage") #Column order
colns <- c(" ", "year", "Antall", "Andel") #Columns rename
setkey(drkDTT, year, alkosistaar, kjonn)
setcolorder(drkDTT, colout)
data.table::setnames(drkDTT, colout, colns)

gt::gt(drkDTT)
```
:::


<!-- Alkoholbruk siste år bland menn i ulike aldersgrupper, 2012-2024 -->

```{r cal-bruk-age}
#| echo: false
#| warning: false
#| output: false

ageBreak <- c(16, 25, 35, 45, 55, 65, Inf)
ageLab <- c("16-24", "25-34", "35-44", "45-54", "55-64", "65+")

group_age(dt = DD, var = "alder", breaks = ageBreak,
          labels = ageLab, new_var = "agecat",
          right = FALSE, missing_values = c(999, 998))


drukkMen <- proscat("year", "alkosistaar", d = DD[kjonn == 1], total = F, z = "agecat")
drukkWom <- proscat("year", "alkosistaar", d = DD[kjonn == 2], total = F, z = "agecat")
```

::: {.panel-tabset}

### Figur
```{r fig-bruk-age-men}
make_hist(d = drukkMen[alkosistaar == 1],
          x = year,
          y = percentage,
          group = agecat,
          n = count,
          title = "Alkoholbruk siste år bland menn i ulike aldersgrupper, 2012- 2024",
          subtitle = "Kilde: Rusundersøkelse 2012-2014 ",
          type = "line",
          dot_size = 6)
```
### Tabell

```{r tab-bruk-age-men}
drukkMen
```

:::

<!-- For kvinner -->

::: {.panel-tabset}

### Figur
```{r fig-bruk-age-wom}
make_hist(d = drukkWom[alkosistaar == 1],
          x = year,
          y = percentage,
          group = agecat,
          n = count,
          title = "Alkoholbruk siste år bland kvinner i ulike aldersgrupper, 2012- 2024",
          subtitle = "Kilde: Rusundersøkelse 2012-2014 ",
          type = "line",
          dot_size = 6)
```
### Tabell

```{r tab-bruk-age-wom}
drukkWom
```
:::


## Andel har drukket 6+ alkoholenheter ved en og samme anledning

Tallene som blir presentert her er for de som har drukket 6+ alkoholenheter
ved en og samme anledning minst en gang i det siste året.

```{r cal-druk6}
## Omkoding
DD[, drink6 := fcase(audit3 %in% 1:4, 1, #Daglig, ukenlig, månedlig og sjeldenere
                     audit3 == 5, 0, #aldri
                     default = NA)]

drk6 <- proscat(x = "year", y = "drink6", d = DD)
```

::: {.panel-tabset}
### Figur

```{r fig-druk6}

make_hist(d = drk6, x = year, y = percentage, n = count,  group = drink6,
          title = "Drukket 6+ enheter daglig eller ukenlig ved en og samme anledning siste år",
          subtitle = "Kilde: Rusundersøkelse 2012-2014 ",
          type = "line", yint = 5)
```

### Tabell

```{r tab-druk6} 
gt::gt(drk6)
```

:::

<!-- Drukket 6+ alder og kjønn -->

```{r cal-druk6-kjonn}
#| echo: false
#| warning: false
#| output: false

drk6Men <- proscat("year", "drink6", d = DD[kjonn == 1], total = F, z = "agecat")
drk6Wom <- proscat("year", "drink6", d = DD[kjonn == 2], total = F, z = "agecat")
```

::: {.panel-tabset}

### Figur
```{r fig-druk6-men}
make_hist(d = drk6Men[drink6 == 1],
          x = year,
          y = percentage,
          group = agecat,
          n = count,
          title = "Drukket 6+ enheter ved en og samme anledning siste år",
          subtitle = "Menn, 2012-2024",
          type = "line")
```
### Tabell

```{r tab-druk6-men}
drk6Men
```

:::

<!-- For kvinner -->

::: {.panel-tabset}

### Figur
```{r fig-druk6-wom}
make_hist(d = drk6Wom[drink6 == 1],
          x = year,
          y = percentage,
          group = agecat,
          n = count,
          title = "Drukket 6+ enheter ved en og samme anledning siste år",
          subtitle = "Kvinner, 2012-2024",
          type = "line")
```
### Tabell

```{r tab-druk6-wom}
drk6Wom
```
:::

